{% extends 'base.html' %}
{% block title %}Transaction — BlockchainIA{% endblock %}

{% block content %}
<a href="/transactions" class="text-sm link-indigo mb-4 inline-block"><i class="fa fa-arrow-left mr-2"></i>Retour aux transactions</a>

<h2 class="text-xl font-bold text-white mb-6">Transaction Details</h2>

<div class="card">
    <div class="space-y-4 p-6">
        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">Transaction Hash</div>
            <div class="col-span-2 font-mono font-bold text-slate-700">{{ tx.id or tx.hash }}</div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">Status</div>
            <div class="col-span-2">
                <span class="{% if tx.status.startswith('fail') %}bg-red-50 text-red-600 border border-red-200{% else %}bg-green-50 text-green-600 border border-green-200{% endif %} px-2 py-1 rounded text-xs font-bold">
                    {% if tx.status.startswith('fail') %}<i class="fa fa-times-circle mr-1"></i> {{ tx.status }}{% else %}<i class="fa fa-check-circle mr-1"></i> {{ tx.status }}{% endif %}
                </span>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">Block</div>
            <div class="col-span-1"><a href="/block/{{ block_index }}" class="text-slate-700 font-semibold">{{ block_index }}</a></div>
            <div class="text-right text-xs text-slate-400">Confirmations: <strong class="text-slate-700">{{ confirmations }}</strong></div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">From</div>
            <div class="col-span-2"><a href="/address/{{ tx.sender }}" class="link-indigo font-mono">{{ tx.sender }}</a></div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">To</div>
            <div class="col-span-2"><a href="/address/{{ tx.receiver }}" class="link-indigo font-mono">{{ tx.receiver }}</a></div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">Value</div>
            <div class="col-span-1"><span class="bg-slate-100 px-3 py-1 rounded text-sm font-bold border border-slate-200">{{ tx.amount }} €</span></div>
            <div class="text-right text-xs text-slate-400">Frais: <strong class="text-slate-700">{{ fee }} €</strong></div>
        </div>

        <div class="grid grid-cols-3 gap-4 border-b pb-4">
            <div class="text-xs text-slate-500">Timestamp</div>
            <div class="col-span-2 text-slate-700">{{ formatted_time }}</div>
        </div>

        <div class="grid grid-cols-3 gap-4 pb-4">
            <div class="text-xs text-slate-500">Signature</div>
            <div class="col-span-2">
                {% if signature_valid %}
                    <span class="text-green-600 font-bold">Valide ✅</span>
                {% else %}
                    <span class="text-red-600 font-bold">Invalide ❌</span>
                {% endif %}
            </div>
        </div>

        <div>
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm text-slate-700 font-semibold">Données brutes (JSON)</h3>
                <button id="copyBtn" class="text-xs bg-indigo-600 text-white px-2 py-1 rounded">Copier</button>
            </div>
            <pre id="rawJson" class="bg-slate-100 text-slate-900 p-3 rounded text-xs overflow-auto">{{ raw_json | tojson(indent=2) }}</pre>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function(){
        const btn = document.getElementById('copyBtn');
        btn && btn.addEventListener('click', function(){
            const txt = document.getElementById('rawJson').innerText;
            navigator.clipboard && navigator.clipboard.writeText(txt).then(()=>{
                btn.innerText = 'Copié';
                setTimeout(()=> btn.innerText = 'Copier', 1500);
            }).catch(()=>{ alert('Copie impossible'); });
        });
    });
</script>
{% endblock %}