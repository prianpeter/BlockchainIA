<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}BlockchainIA{% endblock %}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{ 
      --brand: #030f26; 
      --accent: #1e88ff; 
      --accent-2: #8b5cf6; 
      --accent-3: #14b8a6; 
      --bg-overlay-opacity: 0.12; 
      --header-contrast: rgba(255,255,255,0.96); 
      --glow-blue: rgba(30,136,255,0.4);
      --glow-purple: rgba(139,92,246,0.4);
      --glow-cyan: rgba(20,184,166,0.4);
    }
    
    * { transition: background-color .3s ease, border-color .3s ease; }
    body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

    /* Fond animé moderne & futuriste, très doux (CSS only) */
    .chain-bg {
      position: fixed;
      inset: 0;
      z-index: -20;
      pointer-events: none;
      background-color: #020617; /* noir bleuté */
      background-image:
        radial-gradient(circle at 15% 20%, rgba(30,136,255,0.25), transparent 55%),
        radial-gradient(circle at 80% 80%, rgba(139,92,246,0.25), transparent 55%),
        radial-gradient(circle at 50% 10%, rgba(20,184,166,0.16), transparent 55%);
      background-repeat: no-repeat;
      overflow: hidden;
    }

    /* Grille futuriste très légère */
    .chain-bg::before {
      content: '';
      position: absolute;
      inset: -20%;
      pointer-events: none;
      background-image:
        linear-gradient(rgba(15,23,42,0.0) 0, rgba(15,23,42,0.0) 31px, rgba(30,64,175,0.35) 32px),
        linear-gradient(90deg, rgba(15,23,42,0.0) 0, rgba(15,23,42,0.0) 31px, rgba(30,64,175,0.35) 32px);
      background-size: 100% 32px, 32px 100%;
      opacity: 0.35;
      mix-blend-mode: screen;
      animation: gridDrift 40s linear infinite;
    }

    /* Orbe lumineux qui flotte doucement */
    .chain-bg::after {
      content: '';
      position: absolute;
      width: 40rem;
      height: 40rem;
      border-radius: 999px;
      top: 10%;
      left: -10%;
      pointer-events: none;
      background:
        radial-gradient(circle at 30% 30%, rgba(56,189,248,0.5), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(129,140,248,0.45), transparent 60%);
      filter: blur(18px);
      opacity: 0.55;
      mix-blend-mode: screen;
      animation: orbFloat 55s ease-in-out infinite alternate;
    }

    @keyframes gridDrift {
      0%   { transform: translate3d(0, 0, 0); opacity: 0.35; }
      50%  { transform: translate3d(-5%, -6%, 0); opacity: 0.45; }
      100% { transform: translate3d(-10%, -10%, 0); opacity: 0.35; }
    }

    @keyframes orbFloat {
      0% {
        transform: translate3d(0, 0, 0) scale(1);
        opacity: 0.55;
      }
      50% {
        transform: translate3d(12%, 8%, 0) scale(1.05);
        opacity: 0.65;
      }
      100% {
        transform: translate3d(24%, 16%, 0) scale(1.08);
        opacity: 0.55;
      }
    }

    /* Enhanced cards with glassmorphism */
    .card { 
      background: linear-gradient(145deg, rgba(255,255,255,0.98), rgba(251,253,255,0.96)); 
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: .625rem; 
      box-shadow: 
        0 12px 40px rgba(15,23,42,0.08),
        0 4px 12px rgba(30,136,255,0.04),
        inset 0 1px 0 rgba(255,255,255,0.5);
      transition: all .35s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(30,136,255,0.08), transparent);
      transition: left .6s ease;
    }
    
    .card:hover { 
      transform: translateY(-8px) scale(1.01); 
      box-shadow: 
        0 20px 50px rgba(15,23,42,0.12),
        0 8px 20px rgba(30,136,255,0.12),
        0 0 0 1px rgba(30,136,255,0.1),
        inset 0 1px 0 rgba(255,255,255,0.7);
      border-color: rgba(30,136,255,0.2);
    }
    
    .card:hover::before { left: 100%; }

    /* Enhanced links with glow */
    .link-indigo { 
      color: var(--accent); 
      transition: all .25s cubic-bezier(0.4, 0, 0.2, 1); 
      position: relative;
      text-shadow: 0 0 0 transparent;
    }
    
    .link-indigo:hover { 
      color: var(--accent-2); 
      transform: translateY(-2px);
      text-shadow: 0 0 12px var(--glow-purple), 0 0 24px var(--glow-purple);
    }

    /* Button enhancements */
    button, input[type="submit"], a.bg-indigo-600, .bg-indigo-600 {
      position: relative;
      overflow: hidden;
      transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 14px rgba(30,136,255,0.3);
    }
    
    button::before, input[type="submit"]::before, a.bg-indigo-600::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width .5s ease, height .5s ease;
    }
    
    button:hover, input[type="submit"]:hover, a.bg-indigo-600:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 24px rgba(30,136,255,0.4), 0 0 0 2px rgba(30,136,255,0.2);
    }
    
    button:hover::before, input[type="submit"]:hover::before, a.bg-indigo-600:hover::before {
      width: 300px;
      height: 300px;
    }

    button:active, input[type="submit"]:active {
      transform: translateY(0) scale(0.98);
    }

    /* Enhanced header with glassmorphism */
    header {
      backdrop-filter: blur(16px) saturate(180%);
      background: linear-gradient(180deg, rgba(3,15,38,0.98), rgba(3,15,38,0.95)) !important;
      border-bottom: 1px solid rgba(30,136,255,0.1);
      box-shadow: 0 4px 24px rgba(0,0,0,0.2), 0 0 0 1px rgba(30,136,255,0.05);
      transition: all .3s ease;
    }

    header a {
      transition: all .25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    header a::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width .3s ease;
      border-radius: 2px;
    }

    header a:hover::after {
      width: 100%;
    }

    header a:hover {
      text-shadow: 0 0 12px var(--glow-blue);
    }

    /* Input enhancements */
    input[type="text"], input[type="search"] {
      transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    input[type="text"]:focus, input[type="search"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 
        0 0 0 3px rgba(30,136,255,0.1),
        inset 0 2px 4px rgba(0,0,0,0.1),
        0 4px 12px rgba(30,136,255,0.15);
      transform: translateY(-1px);
    }

    /* Table row hover effects */
    tbody tr {
      transition: all .25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    tbody tr:hover {
      background: linear-gradient(90deg, rgba(30,136,255,0.04), rgba(139,92,246,0.02)) !important;
      box-shadow: 0 2px 8px rgba(30,136,255,0.08);
    }

    /* Enhanced entrance animations with stagger */
    .animate-fadeUp { 
      animation: fadeUp .6s cubic-bezier(0.4, 0, 0.2, 1) both; 
    }
    
    @keyframes fadeUp { 
      from { opacity: 0; transform: translateY(20px) scale(0.96); } 
      to { opacity: 1; transform: translateY(0) scale(1); } 
    }

    .card:nth-child(1) { animation-delay: 0.05s; }
    .card:nth-child(2) { animation-delay: 0.1s; }
    .card:nth-child(3) { animation-delay: 0.15s; }
    .card:nth-child(4) { animation-delay: 0.2s; }
    .card:nth-child(5) { animation-delay: 0.25s; }
    .card:nth-child(6) { animation-delay: 0.3s; }

    /* Icon animations */
    .fa-cube, .fa-paper-plane {
      transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-block;
    }

    .card:hover .fa-cube, .card:hover .fa-paper-plane {
      transform: rotateY(180deg) scale(1.1);
      filter: drop-shadow(0 0 8px var(--glow-purple));
    }

    /* Badge/span enhancements */
    .bg-slate-100, .rounded {
      transition: all .25s ease;
    }

    .bg-slate-100:hover {
      background-color: rgba(30,136,255,0.1) !important;
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(30,136,255,0.15);
    }

    /* Pagination enhancements */
    nav a, nav span {
      transition: all .25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    nav a:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30,136,255,0.2);
    }

    nav .bg-indigo-600 {
      box-shadow: 0 4px 14px rgba(30,136,255,0.4);
      animation: pulseButton 2s ease-in-out infinite;
    }

    @keyframes pulseButton {
      0%, 100% { box-shadow: 0 4px 14px rgba(30,136,255,0.4); }
      50% { box-shadow: 0 6px 20px rgba(30,136,255,0.6); }
    }

    /* Footer enhancement */
    footer {
      backdrop-filter: blur(16px) saturate(180%);
      box-shadow: 0 -4px 24px rgba(0,0,0,0.1);
      transition: all .3s ease;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { 
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    .muted { color: #9ca3af; transition: color .3s ease; }
    .muted:hover { color: #e5e7eb; }
  </style> 
  </head>
  <body class="bg-black text-slate-100 min-h-screen flex flex-col">
  <!-- Fond animé type "chaîne" en pur CSS, sans texte -->
  <div class="chain-bg" aria-hidden="true"></div>
  <header class="sticky top-0 z-50 bg-[var(--brand)] shadow-md">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <a href="/" class="flex items-center space-x-3 no-underline text-[var(--header-contrast)]">
          <i class="fa-solid fa-cube text-[var(--accent-2)] text-2xl"></i>
          <span class="font-semibold text-lg">BlockchainIA</span>
        </a>
        <nav class="hidden md:flex items-center space-x-4 text-sm">
          <a href="/blocks" class="text-[var(--header-contrast)] hover:text-white">Blocks</a>
          <a href="/transactions" class="text-[var(--header-contrast)] hover:text-white">Transactions</a>
          <a href="/miners" class="text-[var(--header-contrast)] hover:text-white">Mineurs</a>
          <a href="/security" class="text-[var(--header-contrast)] hover:text-white">Securite IA</a>
          <a href="/blockchain-analysis" class="text-[var(--header-contrast)] hover:text-white">Analyse IA</a>
          <a href="/audit" class="text-[var(--header-contrast)] hover:text-white">Audit IA</a>
          <a href="/download" class="text-[var(--header-contrast)] hover:text-white">Miner</a>
        </nav>
      </div>

      <div class="flex items-center space-x-3">
        <form action="/search" method="get" class="hidden sm:flex items-center">
          <input type="text" name="q" placeholder="Search address / tx / block" class="bg-slate-800 text-white placeholder-slate-400 border border-slate-700 rounded px-3 py-1 text-sm w-64" />
          <button type="submit" class="ml-2 bg-[var(--accent)] text-white px-3 py-1 rounded text-sm">Search</button>
        </form>
        <a href="/" class="text-sm text-[var(--header-contrast)]">Explorer</a>
      </div>
    </div>
  </header> 

  <main class="max-w-7xl mx-auto px-4 py-8 animate-fadeUp flex-1 w-full">
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-[var(--brand)] border-t border-[rgba(255,255,255,0.04)] mt-auto w-full">
    <div class="max-w-7xl mx-auto px-4 py-4 text-sm text-[var(--header-contrast)]">© 2025 BlockchainIA — Minimal explorer</div>
  </footer>

  <!-- Bouton flottant AI Assistant (masqué sur home) -->
  <button id="aiChatBtn" class="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow-lg hover:bg-indigo-700 transition z-50 {% if request.endpoint == 'home' %}hidden{% endif %}">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
    </svg>
  </button>

  <!-- Modal AI Chat -->
  <div id="aiChatModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl mx-4 flex flex-col" style="max-height: 80vh;">
      <div class="flex items-center justify-between p-4 border-b bg-indigo-600 text-white rounded-t-lg">
        <h3 class="font-bold text-lg">Assistant Blockchain IA</h3>
        <button id="closeChat" class="text-white hover:text-gray-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3" style="min-height: 300px; max-height: 500px;">
        <div class="text-sm text-gray-500 text-center py-4">
          Posez vos questions sur la blockchain, les hash, les transactions, etc.
        </div>
      </div>
      
      <div class="p-4 border-t">
        <form id="chatForm" class="flex gap-2">
          <input 
            type="text" 
            id="chatInput" 
            placeholder="Ex: C'est quoi un hash ?"
            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-900"
            autocomplete="off"
          />
          <button 
            type="submit" 
            class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition"
          >
            Envoyer
          </button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Gestion du chat AI
    const chatBtn = document.getElementById('aiChatBtn');
    const chatModal = document.getElementById('aiChatModal');
    const closeChat = document.getElementById('closeChat');
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');

    chatBtn.addEventListener('click', () => {
      chatModal.classList.remove('hidden');
      chatModal.classList.add('flex');
      chatInput.focus();
    });

    closeChat.addEventListener('click', () => {
      chatModal.classList.add('hidden');
      chatModal.classList.remove('flex');
    });

    chatModal.addEventListener('click', (e) => {
      if (e.target === chatModal) {
        chatModal.classList.add('hidden');
        chatModal.classList.remove('flex');
      }
    });

    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const question = chatInput.value.trim();
      if (!question) return;

      // Afficher la question de l'utilisateur
      addMessage(question, 'user');
      chatInput.value = '';

      // Afficher un loader
      const loaderId = addMessage('...', 'assistant', true);

      try {
        const response = await fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await response.json();
        
        // Retirer le loader
        document.getElementById(loaderId)?.remove();

        if (data.error) {
          addMessage('❌ ' + data.error, 'assistant');
        } else {
          addMessage(data.answer, 'assistant');
        }
      } catch (err) {
        document.getElementById(loaderId)?.remove();
        addMessage('❌ Erreur de connexion. Vérifiez qu\'Ollama est lancé (localhost:11434)', 'assistant');
      }
    });

    function addMessage(text, type, isLoader = false) {
      const msgId = 'msg-' + Date.now();
      const div = document.createElement('div');
      div.id = msgId;
      div.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;
      
      const bubble = document.createElement('div');
      bubble.className = `max-w-[80%] px-4 py-2 rounded-lg ${
        type === 'user' 
          ? 'bg-indigo-600 text-white' 
          : 'bg-gray-100 text-gray-900'
      } ${isLoader ? 'animate-pulse' : ''}`;
      bubble.textContent = text;
      
      div.appendChild(bubble);
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      return msgId;
    }
  </script>
</body>
</html>